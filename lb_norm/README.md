## lb_norm
Normalize copy number estimates using the median of a set of control samples.  Note that this
works with estimates produced by lb_predict_cn; taking the files produced by the copy number
prediction and producing a normalized output.


 - [Introduction](#intro)
 - [Installation](#install)
 - [General usage](#usage)
   - [Input files](#input_files)
   - [Output files](#output_files)
   - [Command line options](#cli)
 - [Changes](#changes)

## <a name="intro"></a>Introduction

lb_norm is a utility that takes the CN predictions generated by [lb_predict_cn](https://github.com/heathsc/lbtools/tree/main/lb_predict_cn)
from a set of samples and an optional set of controls, and will normalize the CN predictions using the 
median of the predictions made on the control group.  Note that the samples and controls may overlap, and if no
separate control group is given the entire sample group is used as controls for the purpose of normalization.

## <a name="install"></a>Installation
For installation see the instructions for the [lbtools package](https://github.com/heathsc/lbtools)

After a successful build the executable will be found in target/release/.  It
should be copied somewhere where it can be found by the shell.

Once installed, basic help can be found by invoking lb_norm with
the -h flag.

## <a name="usage"></a>General usage

### <a name="input_files"></a>Input files

lb_norm requires at a minimum an input file with the list of samples to process, for example:
```
sample1
sample2
sample3
sample4
```
Files with the copy number predictions from 
[lb_predict_cn](https://github.com/heathsc/lbtools/tree/main/lb_predict_cn)
will be searched for according to the **input-dir** and **input-prefix** [command line options](#cli).
All input files can be compressed with many programs such as bgzip, gzip, xz, zstd or bgzip2.

### <a name="output_files"></a>Output files

An output directory is made (if not already existing) for each sample, and within this directory an output file
is created per contig listed in the contig file.   By default, the sample output directories are created in the current 
directory, and each contig specific file will be names cov_*contig name*.txt i.e., cov_chr2.txt.
The behaviour can be changed via the [command line options](#cli), in particular look at the 
**output-dir** and **output-prefix** options.

The individual output files have a simple structure being tab delimited text files with 4 columns.
The 4 columns are:
 - contig name
 - mid-point of genomic bin
 - normalized copy number estimate
 - previous copy number estimate

A fragment of an example output file is shown below:
```
chr5    5895000 2.1315  2.1026
chr5    5905000 2.1541  2.0512
chr5    5915000 2.0000  2.1377
chr5    5925000 1.9759  2.0718
chr5    5935000 2.0816  2.1377
chr5    5945000 1.9383  2.1223
chr5    5955000 2.0537  1.9425
chr5    5965000 2.0429  2.0395
chr5    5975000 2.1682  2.2196
chr5    5985000 1.9221  1.9609
chr5    5995000 2.1951  2.1933
chr5    6005000 1.9040  1.9855
chr5    6015000 2.0862  2.0357
chr5    6025000 1.9390  1.9470
chr5    6035000 2.0279  2.1003
chr5    6045000 2.1505  2.2638
chr5    6055000 2.0262  2.0072
chr5    6065000 2.1776  2.2077
chr5    6075000 2.0397  2.0415
```
### <a name="cli"></a>Command line options

In addition to the sample input file, there are options to set the input and output directories
and prefixes, and to specify an explicit set of controls.

A minimal command line invocation would therefore be:
```
lb_norm sample_list.txt
```
And a more typical command line showing multiple options would be:
```
lb_predict_cn -P cov -p ncov -c control_list.txt sample_list.txt
```

The second example would use and explicit list of controls found in the file *control_list.txt",
using the prefix "cov" for the input files and "ncov" for the normalized output files.


| Short | Long          | Description                                           | Default           |
|-------|---------------|-------------------------------------------------------|-------------------|
| P     | input-prefix  | Prefix for input files                                | cov               |
| p     | output-prefix | Prefix for output files                               | ncov              |
| D     | input-dir     | Input directory                                       | current directory |
| d     | output-dir    | Output directory                                      | current directory |
| c     | control-list  | File with list of control samples                     |                   |
| l     | loglevel      | Set log level (none, error, warn, info, debug, trace) | info              |

## <a name="changes"></a>Changes

- 0.3.0 First public release

